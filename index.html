<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Habit Tracker</title>

    <style>
      :root {
     --primary: #4f46e5;
     --success: #10b981;
     --bg: #f8fafc;
     --text: #1e293b;
    }

    body {
    font-family: 'Segoe UI', sans-serif;
    background-color: #f0f2f5;
    display: flex;
    justify-content: center;
    padding-top: 50px;
    margin: 0;
    }

    .container {
    background: white;
    width: 90%;
    max-width: 450px;
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }

    h1 {
    text-align: center;
    color: #1a73e8;
    font-size: 22px;
    margin-bottom: 25px;
    }

    /* Ti·∫øn ƒë·ªô */
    .progress-container {
    background: #e8eaed;
    height: 12px;
    border-radius: 10px;
    overflow: hidden;
    }

    .progress-bar {
    background: linear-gradient(90deg, #34a853, #b7e1cd);
    width: 0%;
    height: 100%;
    transition: 0.5s ease;
    }

    #progressText {
    text-align: center;
    font-size: 13px;
    color: #5f6368;
    margin: 10px 0 25px;
    }

   /* Nh·∫≠p li·ªáu */
    .input-group {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    }

    input {
    flex: 1;
    padding: 12px;
    border: 1px solid #dadce0;
    border-radius: 8px;
    outline: none;
    }

    button#addBtn {
    background: #1a73e8; /* M√†u xanh ch·ªß ƒë·∫°o */
    color: white;
    border: none;
    padding: 12px 30px; /* TƒÉng kho·∫£ng c√°ch ƒë·ªám (Tr√™n-D∆∞·ªõi: 12px, Tr√°i-Ph·∫£i: 30px) */
    border-radius: 12px; /* Bo g√≥c m·ªÅm m·∫°i h∆°n */
    font-size: 16px;    /* TƒÉng k√≠ch th∆∞·ªõc ch·ªØ */
    font-weight: 700;   /* L√†m ch·ªØ ƒë·∫≠m h∆°n */
    cursor: pointer;
    transition: all 0.2s ease; /* Hi·ªáu ·ª©ng m∆∞·ª£t m√† khi nh·∫•n */
    box-shadow: 0 4px 6px rgba(26, 115, 232, 0.2); /* Th√™m b√≥ng ƒë·ªï cho n√∫t n·ªïi l√™n */
    }

/* Th√™m hi·ªáu ·ª©ng khi di chu·ªôt v√†o (Hover) */
    button#addBtn:hover {
    background: #1557b0; /* M√†u ƒë·∫≠m h∆°n m·ªôt ch√∫t */
    transform: scale(1.05); /* N√∫t to l√™n 5% khi r√™ chu·ªôt v√†o */
    box-shadow: 0 6px 12px rgba(26, 115, 232, 0.3);
    }

    /* Hi·ªáu ·ª©ng khi nh·∫•n v√†o (Active) */
    button#addBtn:active {
    transform: scale(0.98); /* N√∫t h∆°i l√∫n xu·ªëng khi nh·∫•n */
    }

   /* Danh s√°ch */
    #habitList {
    padding: 0;
    list-style: none;
    }

    li {
    background: #fff;
    border: 1px solid #f1f3f4;
    padding: 15px;
    border-radius: 12px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.02);
    cursor: pointer;
    transition: 0.2s;
    }

    li:hover { transform: translateY(-2px); }

    .streak {
    color: #ea4335;
    font-weight: bold;
    font-size: 14px;
    }

    .delete-btn {
    background: #fce8e6;
    color: #d93025;
    border: none;
    padding: 5px 10px;
    border-radius: 5px;
    cursor: pointer;
    }

    .reset-btn {
    width: 100%;
    background: none;
    border: none;
    color: #9aa0a6;
    font-size: 12px;
    margin-top: 20px;
    cursor: pointer;
    text-decoration: underline;
    }
    /* Thi·∫øt k·∫ø huy hi·ªáu */
.rank-badge {
    font-size: 11px;
    padding: 3px 8px;
    border-radius: 10px;
    margin-left: 8px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    vertical-align: middle;
}

/* C√°c c·∫•p ƒë·ªô */
.rank-novice { background: #e2e8f0; color: #64748b; }    /* C·∫•p 1: X√°m (T·∫≠p s·ª±) */
.rank-warrior { background: #dbeafe; color: #1e40af; }   /* C·∫•p 2: Xanh (Chi·∫øn binh) */
.rank-master { background: #fef9c3; color: #854d0e; }    /* C·∫•p 3: V√†ng (B·∫≠c th·∫ßy) */
.rank-legend { background: #fce7f3; color: #be185d; box-shadow: 0 0 10px #fbcfe8; } /* C·∫•p 4: T√≠m (Huy·ªÅn tho·∫°i) */

/* Hi·ªáu ·ª©ng nh√°y khi xong */
@keyframes pulse {
    0% { background-color: #fff; }
    50% { background-color: #e6f4ea; }
    100% { background-color: #fff; }
}
.completed-anim { animation: pulse 0.6s ease; }
    </style>
</head>
<body>
    <div class="container">
    <h1>TH√ìI QUEN M·ªñI NG√ÄY</h1>

    <div class="progress-section">
    <div class="progress-container">
    <div id="progressBar" class="progress-bar"></div>
    </div>
        <p id="progressText">H√¥m nay b·∫°n ƒë√£ ho√†n th√†nh 0%</p>
    </div>

    <div class="input-group">
        <input type="text" id="habitInput" placeholder="Nh·∫≠p th√≥i quen m·ªõi...">
        <button id="addBtn">Th√™m m·ªôt th√≥i quen</button>
    </div>
    <ul id="habitList"></ul>
    <button id="resetBtn" class="reset-btn">X√≥a to√†n b·ªô d·ªØ li·ªáu</button>
    </div>

    <audio id="successSound" src="https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3"></audio>
    <audio id="addSound" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"></audio>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <script >
       const habitInput = document.getElementById('habitInput');
       const addBtn = document.getElementById('addBtn');
       const habitList = document.getElementById('habitList'); // L·∫•y danh s√°ch

    addBtn.addEventListener('click', function() {
       const text = habitInput.value;

       if (text !== "") { 
        // 1. T·∫°o m·ªôt th·∫ª li m·ªõi
       const newHabit = document.createElement('li');
        
        // 2. Thi·∫øt l·∫≠p n·ªôi dung cho th·∫ª li (gi·ªëng c·∫•u tr√∫c c√°c th·∫ª c≈©)
        newHabit.innerHTML = `
          <span class="habit-name">${text}</span>
          <span class="streak">üî• <span class="streak-count">0</span> ng√†y</span>
          <button class="delete-btn">X√≥a</button>
        `;

        // 3. G·∫Øn th·∫ª li n√†y v√†o danh s√°ch ul
        habitList.appendChild(newHabit);

        // 4. X√≥a ch·ªØ trong √¥ nh·∫≠p sau khi th√™m xong
        habitInput.value = "";
        document.getElementById('addSound').play();
        saveData();
        updateProgress();
        }
    });
     //  Trung t√¢m ƒëi·ªÅu khi·ªÉn: X√≥a, TƒÉng streak v√† L∆∞u d·ªØ li·ªáu
    habitList.addEventListener('click', function(event) {
    //  X·ª¨ L√ù N√öT X√ìA
        if (event.target.classList.contains('delete-btn')) {
        const li = event.target.closest('li');
        li.remove(); 
        saveData(); 
        updateProgress(false);
        return; 
        }

    //  X·ª¨ L√ù TƒÇNG STREAK (Khi nh·∫•n v√†o th√≥i quen)
        const li = event.target.closest('li');
        if (li) {
        const today = new Date().toLocaleDateString();
        const lastDate = li.getAttribute('data-last-completed');

        //  Ki·ªÉm tra n·∫øu h√¥m nay ƒë√£ nh·∫•n r·ªìi
        if (lastDate === today) {
            alert("B·∫°n ƒë√£ ho√†n th√†nh th√≥i quen n√†y h√¥m nay r·ªìi! ‚ú®");
            return;
        }

        //  N·∫øu ch∆∞a nh·∫•n: TƒÉng con s·ªë streak
        // --- TƒÉng s·ªë v√† C·∫≠p nh·∫≠t Huy hi·ªáu ngay l·∫≠p t·ª©c ---
        const countSpan = li.querySelector('.streak-count');
        let currentCount = parseInt(countSpan.innerText);
        const newStreak = currentCount + 1;
        countSpan.innerText = newStreak;

// G·ªçi h√†m ki·ªÉm tra c·∫•p ƒë·ªô m·ªõi
const rankInfo = getRank(newStreak);

// T√¨m c√°i huy hi·ªáu ƒëang c√≥ tr√™n d√≤ng ƒë√≥ v√† thay ƒë·ªïi n√≥
const badge = li.querySelector('.rank-badge');
if (badge) {
    badge.innerText = rankInfo.name; // ƒê·ªïi t√™n (VD: T·∫≠p s·ª± -> Chi·∫øn binh)
    badge.className = `rank-badge ${rankInfo.class}`; // ƒê·ªïi m√†u
}
// -----------------------------------------------------------
        // ---HI·ªÜU ·ª®NG V√Ä √ÇM THANH---
        document.getElementById('successSound').play(); // Ph√°t ti·∫øng "Ting"
        li.classList.add('completed-animation'); // Th√™m hi·ªáu ·ª©ng ph√°t s√°ng
        setTimeout(() => li.classList.remove('completed-animation'), 600); // X√≥a hi·ªáu ·ª©ng sau 0.6 gi√¢y

        //  Ghi ch√∫ l·∫°i ng√†y ho√†n th√†nh v√†o th·∫ª li
        li.setAttribute('data-last-completed', today);

        //  L∆∞u tr·∫°ng th√°i m·ªõi v√†o b·ªô nh·ªõ
        saveData();
        updateProgress(true);
        }
    }); // K·∫øt th√∫c kh·ªëi ƒëi·ªÅu khi·ªÉn danh s√°ch
     
     // --- ƒê·ªäNH NGHƒ®A H√ÄM  ---

    function saveData() {
        const habits = [];
        const liItems = document.querySelectorAll('#habitList li');
        liItems.forEach(li => {
        habits.push({
            name: li.querySelector('.habit-name').innerText,
            count: li.querySelector('.streak-count').innerText,
            lastDate: li.getAttribute('data-last-completed')
        });
        });
        localStorage.setItem('habits', JSON.stringify(habits));
    }

function updateProgress(coChoPhaoNo) { // Bi·∫øn n√†y ƒë·ªÉ ƒëi·ªÅu khi·ªÉn ph√°o
    const liItems = document.querySelectorAll('#habitList li');
    const total = liItems.length;
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');

    if (total === 0) {
        progressBar.style.width = "0%";
        progressText.innerText = "H√£y th√™m th√≥i quen ƒë·ªÉ b·∫Øt ƒë·∫ßu!";
        return;
    }

    const today = new Date().toLocaleDateString();
    let completedToday = 0;

    liItems.forEach(li => {
        if (li.getAttribute('data-last-completed') === today) {
            completedToday++;
        }
    });

    const percent = Math.round((completedToday / total) * 100);
    progressBar.style.width = percent + "%";
    progressText.innerText = `H√¥m nay b·∫°n ƒë√£ ho√†n th√†nh ${percent}%`;

    // KH√ìA AN TO√ÄN: Ch·ªâ khi coChoPhaoNo l√† TRUE th√¨ ph√°o m·ªõi ƒë∆∞·ª£c ph√©p n·ªï
    if (coChoPhaoNo === true && percent === 100) {
        confetti({
            particleCount: 150,
            spread: 70,
            origin: { y: 0.6 }
        });
    }
}
// H√†m t√≠nh danh hi·ªáu d·ª±a tr√™n s·ªë ng√†y Streak
function getRank(streak) {
    if (streak >= 66) return { name: 'HUY·ªÄN THO·∫†I üëë', class: 'rank-legend' };
    if (streak >= 21) return { name: 'B·∫¨C TH·∫¶Y ‚öîÔ∏è', class: 'rank-master' };
    if (streak >= 7)  return { name: 'CHI·∫æN BINH üî•', class: 'rank-warrior' };
    return { name: 'T·∫¨P S·ª∞ üå±', class: 'rank-novice' };
}

// L·ªánh k√≠ch ho·∫°t n·∫°p d·ªØ li·ªáu khi v·ª´a m·ªü trang
loadData();

function loadData() {
    const savedHabits = localStorage.getItem('habits');
    if (savedHabits) {
        const habits = JSON.parse(savedHabits);
        
        // X√≥a s·∫°ch danh s√°ch c≈© ƒë·ªÉ n·∫°p l·∫°i t·ª´ ƒë·∫ßu
        habitList.innerHTML = "";

        habits.forEach(habit => {
            const newHabit = document.createElement('li');
            
            // Kh√¥i ph·ª•c ng√†y ho√†n th√†nh g·∫ßn nh·∫•t (n·∫øu c√≥)
            if (habit.lastDate) {
                newHabit.setAttribute('data-last-completed', habit.lastDate);
            }

            // --- ƒêO·∫†N M·ªöI: T√çNH TO√ÅN DANH HI·ªÜU ---
            // L∆∞u √Ω: Trong data c≈© b·∫°n l∆∞u l√† 'count', n√™n ·ªü ƒë√¢y ta d√πng habit.count
            const currentStreak = habit.count || 0; 
            const rankInfo = getRank(currentStreak);
            // -------------------------------------

            newHabit.innerHTML = `
                <span class="habit-name">
                    ${habit.name} 
                    <span class="rank-badge ${rankInfo.class}">${rankInfo.name}</span>
                </span>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span class="streak">
                        üî• <span class="streak-count">${currentStreak}</span> ng√†y
                    </span>
                    <button class="delete-btn">X√≥a</button>
                </div>
            `;
            
            // Th√™m hi·ªáu ·ª©ng n·∫øu ƒë√£ ho√†n th√†nh trong h√¥m nay
            const today = new Date().toLocaleDateString();
            if (habit.lastDate === today) {
                newHabit.classList.add('completed');
            }

            habitList.appendChild(newHabit);
        });
        
        // C·∫≠p nh·∫≠t l·∫°i thanh ti·∫øn tr√¨nh (kh√¥ng b·∫Øn ph√°o hoa)
        updateProgress(false);
    }
}

// G·ªçi h√†m l·∫•y d·ªØ li·ªáu ngay khi v·ª´a t·∫£i trang
loadData();
// === C√ÅC H√ÄM D√ôNG ƒê·ªÇ TEST (DEBUG) ===

// 1. H√†m Hack Streak: Bi·∫øn ngay th√†nh Huy·ªÅn Tho·∫°i ƒë·ªÉ xem huy hi·ªáu ƒë·ªïi m√†u ch∆∞a
function hackStreak(days) {
    const habits = document.querySelectorAll('#habitList li');
    if (habits.length === 0) {
        alert("B·∫°n ph·∫£i th√™m √≠t nh·∫•t 1 th√≥i quen ƒë·ªÉ hack!");
        return;
    }

    habits.forEach(li => {
        // C·∫≠p nh·∫≠t s·ªë hi·ªÉn th·ªã
        const countSpan = li.querySelector('.streak-count');
        countSpan.innerText = days;

        // C·∫≠p nh·∫≠t huy hi·ªáu
        const rankInfo = getRank(days);
        const badge = li.querySelector('.rank-badge');
        if (badge) {
            badge.innerText = rankInfo.name;
            badge.className = `rank-badge ${rankInfo.class}`;
        }
    });
    
    // L∆∞u l·∫°i c√°i "s·ª± hack" n√†y v√†o b·ªô nh·ªõ ƒë·ªÉ F5 kh√¥ng b·ªã m·∫•t
    saveData();
    alert(`ƒê√£ hack to√†n b·ªô th√≥i quen l√™n ${days} ng√†y!`);
}

// 2. H√†m Gi·∫£ l·∫≠p ng√†y m·ªõi: Cho ph√©p b·∫•m ho√†n th√†nh ti·∫øp m√† kh√¥ng c·∫ßn ƒë·ª£i mai
function cheatNewDay() {
    const habits = document.querySelectorAll('#habitList li');
    habits.forEach(li => {
        // X√≥a d·∫•u v·∫øt ng√†y h√¥m nay -> M√°y t√≠nh t∆∞·ªüng l√† ch∆∞a l√†m -> Cho l√†m ti·∫øp
        li.removeAttribute('data-last-completed'); 
        li.classList.remove('completed'); // B·ªè g·∫°ch ngang (n·∫øu c√≥ CSS completed)
    });
    
    saveData();
    // Reset thanh ti·∫øn tr√¨nh v·ªÅ 0%
    updateProgress(false); 
    alert("ƒê√£ reset tr·∫°ng th√°i! B·∫°n c√≥ th·ªÉ b·∫•m ho√†n th√†nh l·∫ßn n·ªØa ƒë·ªÉ tƒÉng streak.");
}

// 3. H√†m Test Ph√°o hoa: Xem ph√°o n·ªï cho vui
function testConfetti() {
    confetti({
        particleCount: 150,
        spread: 70,
        origin: { y: 0.6 }
    });
}
    </script>
    <div id="debugPanel" style="
    position: fixed; 
    bottom: 10px; 
    right: 10px; 
    background: #333; 
    color: white; 
    padding: 15px; 
    border-radius: 10px; 
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
    z-index: 9999;
    font-family: monospace;
">
    <h3 style="margin: 0 0 10px 0; border-bottom: 1px solid #555; padding-bottom: 5px;">üõ†Ô∏è TEST TOOL</h3>
    
    <div style="display: flex; flex-direction: column; gap: 8px;">
        <button onclick="hackStreak(65)" style="cursor:pointer; padding: 5px;">üöÄ Hack l√™n 65 ng√†y</button>
        <button onclick="cheatNewDay()" style="cursor:pointer; padding: 5px;">üåÖ Gi·∫£ l·∫≠p 'Ng√†y m·ªõi'</button>
        <button onclick="testConfetti()" style="cursor:pointer; padding: 5px;">üéâ Test Ph√°o hoa</button>
        <button onclick="document.getElementById('debugPanel').style.display='none'" style="cursor:pointer; padding: 5px; background: #ff4444; color: white; border:none;">‚ùå ƒê√≥ng b·∫£ng</button>
    </div>
</div>
</body>
</html>
